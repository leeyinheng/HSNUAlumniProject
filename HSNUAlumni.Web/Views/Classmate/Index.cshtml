<!DOCTYPE html>
 
<html>
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-2.1.4.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/angular.min.js"></script>
<script src="https://rawgit.com/dwmkerr/angular-modal-service/master/dst/angular-modal-service.js"></script>

<body>
    <div  class="container" ng-app="mainapp" ng-controller="serviceCtrl">
    <br/>
    <form>
        <div class="form-group">
            <div class="input-group">
                <div class="container-fluid">
                    <div class="row">
                        選擇班號:
                        <select ng-model="classDropdown">
                            <option value="618">618</option>
                            <option value="619">619</option>
                            <option value="620">620</option>
                            <option value="621">621</option>
                        </select>
                        <i class="glyphicon glyphicon-search"></i>
                        <input type="text" placeholder="Search" ng-model="search">
                    </div>
                </div>
            </div>
        </div>
    </form>
        
       <table class="table table-bordered table-striped">
         
              <tr>
                  <th>Index</th>
                  <th>班號</th>
                  <th>座號</th>
                  <th>姓名</th>
                  <th>英文名</th>
                  <th>性別</th>
                  <th>聯絡狀態</th>
                  <th>手機</th>
                  <th>電郵</th>
                  <th>地址</th>
                  <th>公司</th>
                  <th>職稱</th>
                  <th>家中電話</th>
                  <th>臉書帳號</th>
                  <th>Line帳號</th>
                  <th>備註</th>
                  <th>Command</th>
              </tr>
              <tr ng-repeat="x in list | filter:search" >
                  <td>{{ $index + 1 }}</td>
                  <td>{{ x.ClassId }}</td>
                  <td>{{ x.SeatNumber }}</td>
                  <td>{{ x.Name }}</td>
                  <td>{{ x.EnglishName }}</td>
                  <td>{{ x.Gender }}</td>
                  <td>{{ x.Status }}</td>
                  <td>{{ x.CellPhone }}</td>
                  <td>{{ x.Email }}</td>
                  <td>{{ x.HomeAddress }}</td>
                  <td>{{ x.Company }}</td>
                  <td>{{ x.Position }}</td>
                  <td>{{ x.HomePhone }}</td>
                  <td>{{ x.FaceBookAccount }}</td>
                  <td>{{ x.LineAccount }}</td>
                  <td>{{ x.Notes }}</td>
                  <td> <button ng-click="setSelected(x)" class="btn btn-sm"> Edit </button> </td>
              </tr>
        </table>

        <!-- The actual modal template, just a bit o bootstrap -->
        <script type="text/ng-template" id="modal.html">
            <div class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Contact</h4>
                        </div>
                        <div class="modal-body">
                            <table class="table table-bordered table-responsive">
                                <tr>
                                    <td>
                                        Class:
                                    </td>
                                    <td>
                                        {{data.ClassId}}
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Name:
                                    </td>
                                    <td>
                                        {{data.Name}}
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        SeatNumber:
                                    </td>
                                    <td>
                                        <input type="number" ng-model="data.SeatNumber" /> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        EnglishName:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.EnglishName" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Gender:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.Gender" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Status:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.Status" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Birthday:
                                    </td>
                                    <td>
                                        <input type="date" ng-model="data.Birthday"/> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        CellPhone:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.CellPhone" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Email:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.Email" ng-required="true"/> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        HomeAddress:
                                    </td>
                                    <td>
                                        <textarea type="text" ng-model="data.HomeAddress" class="form-control" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        HomePhone:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.HomePhone" /> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Company:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.Company" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Position:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.Position" /> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        OfficeAddrss:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.OfficeAddrss" /> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        FaceBookAccount:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.FaceBookAccount" /> 
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        LineAccount:
                                    </td>
                                    <td>
                                        <input type="text" ng-model="data.LineAccount" />
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        Notes:
                                    </td>
                                    <td>
                                        <textarea ng-model="data.Notes" class="form-control" />
                                    </td>
                                </tr>

                            </table>
                         
                        </div>
                        <div class="modal-footer">
                            <button type="button" ng-click="close('No')" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" ng-click="close(data)" class="btn btn-primary" data-dismiss="modal">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </script>

    </div>

  

</body>
</html>


 


<script>

    var app = angular.module('mainapp', ['angularModalService'])

    app.value("selectedclassId", "100");

    app.value("data", {
        ClassId: '100',
        SeatNumber:'', 
        Name: 'Test',
        EnglishName: '',
        Gender: '',
        Status: '',
        Birthday: '',
        Notes: '',
        CellPhone: '',
        HomePhone: '',
        OfficePhone: '',
        Email: '',
        FaceBookAccount: '',
        LineAccount: '',
        Company: '',
        Position: '',
        HomeAddress: '',
        OfficeAddrss: '',
        PhotoId: '',
        ModifiedUser: '',
        ModifiedDate: ''
    });

    app.controller('serviceCtrl', function ($scope, $http, ModalService,data) {
        $scope.$watch('classDropdown', function () {

            selectedclassId = $scope.classDropdown;

            $http.get("/api/classmates/" + $scope.classDropdown)
        .error(function (error) {
            alert(error);
        })
        .success(function (response) {
            
            $scope.list = response;
            $scope.myVar = false;
            $scope.itemSelected = null;
            $scope.setSelected = function (itemSelected) {
                $scope.itemSelected = itemSelected;
                data.Name = itemSelected.Name;
                data.Birthday = itemSelected.Birthday;
                data.CellPhone = itemSelected.CellPhone;
                data.ClassId = itemSelected.ClassId;
                data.Company = itemSelected.Company;
                data.Email = itemSelected.Email;
                data.EnglishName = itemSelected.EnglishName;
                data.FaceBookAccount = itemSelected.FaceBookAccount;
                data.Gender = itemSelected.Gender;
                data.HomeAddress = itemSelected.HomeAddress;
                data.HomePhone = itemSelected.HomePhone;
                data.LineAccount = itemSelected.LineAccount;
                data.ModifiedDate = itemSelected.ModifiedDate;
                data.ModifiedUser = itemSelected.ModifiedUser;
                data.Notes = itemSelected.Notes;
                data.OfficeAddrss = itemSelected.OfficeAddrss;
                data.OfficePhone = itemSelected.OfficePhone;
                data.PhotoId = itemSelected.PhotoId;
                data.Position = itemSelected.Position;
                data.SeatNumber = itemSelected.SeatNumber;
                data.Status = itemSelected.Status;
                
                ModalService.showModal({
                    templateUrl: 'modal.html',
                    controller: 'ModalController'
                }).then(function (modal) {
                    modal.element.modal();
                    modal.close.then(function (result) {
                       // $scope.message = "You said " + result;
                        alert('modal.close'); 
                    });
                });
            };
        }
        )
        }); 
        
    });

    app.controller('ModalController', function ($scope, $http, data) {
       
        $scope.data = data;

        $scope.close = function (result) {
            // close(result, 500); // close, but give 500ms for bootstrap to animate
            alert(selectedclassId);
            if (result != 'No') {

                $http.post("/api/classmate/AddorUpdate", result)
                .error(function (e) {
                    alert(e);
                })
                .success(function (response) {
                    alert("Data is Updated.");
                    location.reload();
                 });


            }
           
        };

    });
  

</script>